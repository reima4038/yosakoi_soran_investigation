# Implementation Plan

- [x] 1. バックエンドモデルと API の更新

  - Template モデルに isPublic フィールドを追加し、既存のスキーマを更新する
  - 可視性切り替え用の新しい API エンドポイント PUT /api/templates/:id/visibility を実装する
  - 既存のテンプレート関連 API エンドポイントを修正して isPublic フィールドに対応させる
  - _Requirements: 2.1, 2.2, 2.3, 4.3_

- [x] 2. テンプレート複製 API の修正

  - POST /api/templates/:id/duplicate エンドポイントの永続化処理を確認・修正する
  - 複製されたテンプレートが適切にデータベースに保存されることを確認する
  - 複製時の名前変更ロジックを実装する
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 3. フロントエンドサービスの更新

  - templateService に toggleTemplateVisibility メソッドを追加する
  - 既存のサービスメソッドを修正して isPublic フィールドに対応させる
  - API 呼び出しのエラーハンドリングを改善する
  - _Requirements: 2.2, 2.3, 4.3, 5.3_

- [x] 4. TemplateEditPage コンポーネントの作成

  - 新しい TemplateEditPage コンポーネントを作成する
  - テンプレートデータの事前読み込み機能を実装する
  - フォーム検証とエラーハンドリングを実装する
  - 保存・キャンセル機能を実装する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 5. ルーティング設定の追加

  - App.tsx に /templates/:id/edit ルートを追加する
  - TemplateEditPage コンポーネントをルーティングに組み込む
  - 適切な権限チェックを設定する
  - _Requirements: 1.1, 1.2_

- [x] 6. TemplateList コンポーネントの修正

  - 可視性切り替え UI を追加する（公開・非公開の切り替えボタン）
  - 複製機能を API 呼び出しに修正する
  - モックデータの使用を停止し、実際の API データを使用する
  - エラーハンドリングとローディング状態を改善する
  - _Requirements: 2.1, 3.4, 4.1, 4.2, 4.3, 5.1, 5.2_

- [x] 7. TemplateDetailPage コンポーネントの修正

  - 編集ボタンのリンク先を正しい編集ページに修正する
  - モックデータの使用を停止し、実際の API データを使用する
  - 可視性ステータスの表示を追加する
  - エラーハンドリングを改善する
  - _Requirements: 1.1, 2.1, 4.1, 5.3_

- [x] 8. テンプレートコンポーネントの index.ts を更新

  - TemplateEditPage コンポーネントをエクスポートに追加する
  - 他のコンポーネントから TemplateEditPage をインポートできるようにする
  - _Requirements: 1.1_

- [x] 9. エラーハンドリングとユーザーフィードバックの改善

  - 全てのテンプレート操作にローディングインジケーターを追加する
  - 成功・失敗メッセージの表示を統一する
  - ネットワークエラー時の再試行機能を実装する
  - バリデーションエラーの適切な表示を実装する
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [ ] 10. 統合テストとバグ修正
  - 全ての修正された機能の動作確認を行う
  - テンプレート編集フローの E2E テストを実行する
  - 複製機能の永続化テストを実行する
  - 可視性切り替え機能のテストを実行する
  - 発見されたバグの修正を行う
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4, 3.5, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 5.1, 5.2, 5.3, 5.4, 5.5_
