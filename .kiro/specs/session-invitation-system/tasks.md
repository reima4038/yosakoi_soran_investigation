# Implementation Plan

- [x] 1. バックエンド基盤の実装

  - [x] 1.1 招待リンク生成サービスの実装

    - InvitationService クラスを作成し、JWT 生成とトークン検証機能を実装
    - セッション ID と有効期限を含む JWT トークンの生成ロジックを実装
    - _Requirements: 1.1, 1.2, 4.1_

  - [x] 1.2 セッション招待 API エンドポイントの追加

    - `/sessions/:id/invite-link` GET エンドポイントを実装
    - `/sessions/join/:token` POST エンドポイントを実装
    - 認証とアクセス権限の検証を追加
    - _Requirements: 1.1, 3.1, 3.2, 3.3_

  - [x] 1.3 セッションモデルの拡張
    - セッションモデルに招待設定フィールドを追加
    - 招待リンク使用ログのモデルを作成
    - データベースマイグレーションスクリプトを作成
    - _Requirements: 4.1, 4.2, 5.1_

- [x] 2. 招待リンク生成機能の実装

  - [x] 2.1 招待リンク生成ロジックの実装

    - セッション作成時の自動招待リンク生成を実装
    - JWT 署名とペイロード設定を実装
    - 招待リンク URL 構築ロジックを実装
    - _Requirements: 1.1, 1.2_

  - [x] 2.2 招待リンク取得 API の実装
    - セッション作成者権限の検証を実装
    - 招待リンクレスポンス形式を定義
    - エラーハンドリングとレスポンス処理を実装
    - _Requirements: 1.1, 4.2_

- [ ] 3. 招待リンク参加機能の実装

  - [ ] 3.1 招待トークン検証の実装

    - JWT 署名検証とペイロード解析を実装
    - トークン有効期限チェックを実装
    - セッション存在確認とステータス検証を実装
    - _Requirements: 3.1, 3.3, 4.1_

  - [ ] 3.2 セッション参加処理の実装
    - 参加者のセッション追加ロジックを実装
    - 重複参加の防止処理を実装
    - 参加ログの記録機能を実装
    - _Requirements: 3.4, 5.1, 5.2_

- [ ] 4. フロントエンド招待リンク表示コンポーネントの実装

  - [ ] 4.1 InviteLinkDisplay コンポーネントの作成

    - 招待リンク表示 UI コンポーネントを作成
    - セッション作成者権限での表示制御を実装
    - 招待リンク取得 API との連携を実装
    - _Requirements: 1.1, 2.1_

  - [ ] 4.2 クリップボードコピー機能の実装
    - useClipboard カスタムフックを作成
    - Clipboard API を使用したコピー機能を実装
    - ブラウザサポート検出とフォールバック処理を実装
    - _Requirements: 2.1, 2.2, 2.3_

- [ ] 5. セッション詳細ページの拡張

  - [ ] 5.1 招待リンクセクションの追加

    - SessionDetailPage に招待リンク表示セクションを追加
    - セッション作成者のみに表示する条件分岐を実装
    - 招待リンクコンポーネントの統合を実装
    - _Requirements: 1.1, 2.1_

  - [ ] 5.2 招待リンク使用統計の表示
    - 招待リンク使用回数の表示機能を実装
    - 使用統計取得 API との連携を実装
    - 統計情報の視覚的表示を実装
    - _Requirements: 5.2, 5.3_

- [ ] 6. 招待リンクアクセス処理の実装

  - [ ] 6.1 招待リンクルーティングの実装

    - `/sessions/:id/join` ルートを追加
    - URL パラメータからトークンを取得する処理を実装
    - 招待リンクアクセス専用ページを作成
    - _Requirements: 3.1, 3.2_

  - [ ] 6.2 ログイン状態チェックとリダイレクト処理
    - 未ログインユーザーのログインページリダイレクトを実装
    - ログイン後のセッションページ自動遷移を実装
    - セッション参加完了後の適切なページ遷移を実装
    - _Requirements: 3.2, 3.3_

- [ ] 7. エラーハンドリングとユーザーフィードバック

  - [ ] 7.1 招待リンクエラー処理の実装

    - 無効トークンエラーページを作成
    - セッション不存在エラーの処理を実装
    - 権限不足エラーの適切な表示を実装
    - _Requirements: 3.3, 4.1, 4.2_

  - [ ] 7.2 コピー成功/失敗フィードバックの実装
    - コピー成功時のスナックバー表示を実装
    - コピー失敗時のフォールバック表示を実装
    - 手動コピー用のテキスト選択機能を実装
    - _Requirements: 2.2, 2.3_

- [ ] 8. セキュリティ強化とログ機能

  - [ ] 8.1 招待リンク無効化機能の実装

    - セッション削除時の招待リンク無効化を実装
    - セッション状態変更時の招待リンク管理を実装
    - 手動での招待リンク無効化機能を実装
    - _Requirements: 4.1, 4.2, 4.3_

  - [ ] 8.2 使用ログとセキュリティ監視の実装
    - 招待リンク使用ログの記録機能を実装
    - 異常アクセスパターンの検出を実装
    - セキュリティログの管理機能を実装
    - _Requirements: 5.1, 5.2, 5.3_

- [ ] 9. テスト実装

  - [ ] 9.1 バックエンドユニットテストの作成

    - InvitationService のテストを作成
    - 招待リンク API エンドポイントのテストを作成
    - JWT 生成と検証のテストを作成
    - _Requirements: 1.1, 1.2, 3.1, 3.2_

  - [ ] 9.2 フロントエンドコンポーネントテストの作成

    - InviteLinkDisplay コンポーネントのテストを作成
    - useClipboard フックのテストを作成
    - 招待リンク表示権限のテストを作成
    - _Requirements: 2.1, 2.2_

  - [ ] 9.3 統合テストの作成
    - 招待リンク生成から参加完了までの E2E テストを作成
    - エラーケースの統合テストを作成
    - セキュリティ関連のテストを作成
    - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [ ] 10. 最終統合とドキュメント更新

  - [ ] 10.1 機能統合とテスト

    - 全機能の統合テストを実行
    - ユーザビリティテストを実施
    - パフォーマンステストを実行
    - _Requirements: 1.1, 2.1, 3.1, 4.1, 5.1_

  - [ ] 10.2 ドキュメントとヘルプの更新
    - ユーザーマニュアルに招待機能の説明を追加
    - API ドキュメントを更新
    - 開発者向けドキュメントを更新
    - _Requirements: 1.1, 2.1, 3.1_
