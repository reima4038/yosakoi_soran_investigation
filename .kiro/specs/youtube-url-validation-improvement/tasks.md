# YouTube URL バリデーション改善 - 実装タスク

## 実装タスク一覧

- [x] 1. バックエンド URL 正規化エンジンの実装

  - YouTubeService.extractVideoId メソッドを拡張し、様々な URL 形式に対応
  - URL 正規化クラスの実装（プロトコル補完、ビデオ ID 抽出）
  - 複数の YouTube URL パターンの定義と処理
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [x] 2. エラーメッセージシステムの構築

  - エラータイプの分類と定義（URLValidationErrorType enum）
  - 具体的なエラーメッセージとユーザー向け修正提案のマッピング
  - 多言語対応を考慮したエラーメッセージ構造の実装
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [x] 3. バックエンド API エンドポイントの改善

  - /api/videos/youtube-info エンドポイントの拡張
  - 統合された URL 検証とビデオ情報取得機能の実装
  - 重複チェック機能の統合
  - 詳細なエラーレスポンスの実装
  - _要件: 1.1, 2.1, 3.1_

- [x] 4. フロントエンド URL 正規化ユーティリティの実装

  - クライアントサイド URL 正規化クラスの作成
  - リアルタイムバリデーション機能の実装
  - デバウンス機能付きの入力検証
  - _要件: 4.1, 4.2, 5.1, 5.2_

- [ ] 5. 改善された URL 入力コンポーネントの作成

  - EnhancedURLInput コンポーネントの実装
  - リアルタイムフィードバック表示（成功/エラーインジケーター）
  - 修正提案とサンプル URL の表示機能
  - ローディング状態の視覚的表示
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [ ] 6. VideoRegistrationForm コンポーネントの更新

  - 新しい EnhancedURLInput コンポーネントの統合
  - 改善されたエラーハンドリングの実装
  - ユーザーフレンドリーなエラーメッセージ表示
  - _要件: 2.1, 2.2, 4.3_

- [ ] 7. バリデーションスキーマの更新

  - Yup バリデーションスキーマの緩和
  - フロントエンドでの柔軟な URL 受け入れ
  - サーバーサイドバリデーションとの整合性確保
  - _要件: 1.1, 1.2, 1.3, 1.4, 5.1, 5.2, 5.3, 5.4_

- [ ] 8. YouTube URL パターンテストの実装

  - 様々な URL 形式に対する単体テストの作成
  - エラーケースのテストカバレッジ
  - URL 正規化機能のテスト
  - _要件: 1.1, 1.2, 1.3, 1.4, 5.1, 5.2, 5.3, 5.4_

- [ ] 9. エラーハンドリングの統合テスト

  - フロントエンド-バックエンド間のエラー伝播テスト
  - ユーザー体験の E2E テスト
  - 各種エラーシナリオでの動作確認
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [ ] 10. パフォーマンス最適化の実装

  - URL 検証結果のキャッシュ機能
  - 重複チェックの最適化
  - デバウンス設定の調整
  - _要件: 3.1, 3.2, 4.1_

- [ ] 11. ドキュメントとユーザーガイドの更新

  - 対応 URL 形式の一覧作成
  - トラブルシューティングガイドの作成
  - 開発者向け API 仕様書の更新
  - _要件: 2.1, 2.2, 5.1, 5.2, 5.3, 5.4_

- [ ] 12. 統合テストとデプロイ準備
  - 全機能の統合テスト実行
  - 既存機能への影響確認
  - 本番環境でのテスト準備
  - _要件: 全要件の統合確認_

## 実装の優先順位

### Phase 1: 基盤機能（タスク 1-3）

バックエンドの基盤となる URL 正規化とエラーハンドリング機能を実装

### Phase 2: フロントエンド改善（タスク 4-6）

ユーザーインターフェースの改善とリアルタイムフィードバック機能

### Phase 3: 統合とテスト（タスク 7-9）

フロントエンドとバックエンドの統合、包括的なテスト実装

### Phase 4: 最適化と完成（タスク 10-12）

パフォーマンス最適化、ドキュメント整備、デプロイ準備

## 技術的な注意事項

- 既存の YouTubeService クラスとの後方互換性を維持
- フロントエンドのバリデーションは UX 向上のため、セキュリティはバックエンドで担保
- URL 正規化処理でのメモリ使用量に注意
- YouTube API のレート制限を考慮した実装

## 成功基準

- 95%以上の YouTube URL 形式で正常に動画登録が可能
- URL 関連のエラーメッセージが具体的で理解しやすい
- リアルタイムフィードバックの応答時間が 500ms 以下
- 既存機能に影響を与えない
